این را به زبان های دیگر بخوانید: <a href="https://github.com/Pooria82/Chat-Service/blob/main/README.md">English</a>

# سرویس چت

## نمای کلی

سرویس چت یک برنامه مبتنی بر FastAPI است که امکانات چت در زمان واقعی، احراز هویت کاربران، چت‌های خصوصی، اتاق‌های چت و
آپلود فایل‌های رسانه‌ای را فراهم می‌کند. این سرویس همچنین از WebSocket (Socket.IO) برای پیام‌رسانی زنده پشتیبانی می‌کند.

## ویژگی‌ها

- **احراز هویت کاربران:** ثبت‌نام و ورود کاربران با احراز هویت امن مبتنی بر JWT.
- **چت‌های خصوصی:** امکان چت خصوصی با دیگر کاربران و پیگیری وضعیت آنلاین آن‌ها.
- **اتاق‌های چت:** ایجاد و مدیریت اتاق‌های چت گروهی.
- **آپلود رسانه:** آپلود فایل‌های رسانه‌ای برای اشتراک در اتاق‌های چت.
- **پیام‌رسانی در زمان واقعی:** استفاده از Socket.IO برای پیام‌رسانی در زمان واقعی با پیگیری وضعیت آنلاین.

## پیش‌نیازها

- **Docker:** اطمینان حاصل کنید که Docker و Docker Compose روی سیستم شما نصب شده‌اند.
- **Python 3.8+** (اگر بدون Docker اجرا می‌کنید)

## راه‌اندازی سرویس

### استفاده از Docker (پیشنهادی)

بهترین و ساده‌ترین روش برای راه‌اندازی سرویس استفاده از Docker است. این روش تضمین می‌کند که تمام وابستگی‌ها و تنظیمات به
صورت خودکار مدیریت می‌شوند.

#### مراحل:

1. **کلون کردن مخزن:**

   ```bash
   git clone https://github.com/Pooria82/Chat-Service.git
   cd Chat-Service
   ```

2. **ساخت و اجرای کانتینرها:**

    - **برای لینوکس/مک:**

   ```bash
   docker-compose up --build
   ```

    - **برای ویندوز:**

   ```bash
   docker-compose -f docker-compose.yml up --build
   ```

3. **دسترسی به سرویس:**

    - سرویس در `http://localhost:8000` در دسترس خواهد بود.
    - می‌توانید به مستندات API تعاملی در `http://localhost:8000/docs` دسترسی پیدا کنید.

### اجرای محلی (بدون Docker)

اگر ترجیح می‌دهید سرویس را به‌طور مستقیم روی سیستم خود اجرا کنید:

##### مراحل:

1. **کلون کردن مخزن:**

   ```bash
   git clone https://github.com/Pooria82/Chat-Service.git
   cd Chat-Service
   ```

2. **ایجاد و فعال‌سازی محیط مجازی:**

    - **برای لینوکس/مک:**

   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

    - **برای ویندوز:**

   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```

3. **نصب وابستگی‌ها:**

   ```bash
   pip install -r requirements.txt
   ```

4. **تنظیم متغیرهای محیطی:** یک فایل `.env` در ریشه پروژه با متغیرهای محیطی لازم ایجاد کنید. مثال:

   ```bash
   SECRET_KEY=your_secret_key
   DATABASE_URL=mongodb://localhost:27017/chat_db
   ```

5. **اجرای برنامه:**

   ```bash
   uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

6. **دسترسی به سرویس:**

    - سرویس در `http://localhost:8000` در دسترس خواهد بود.
    - می‌توانید به مستندات API تعاملی در `http://localhost:8000/docs` دسترسی پیدا کنید.

## استفاده از API‌ها

### احراز هویت

- **ثبت‌نام:**

    - **آدرس:** `POST /auth/signup`
    - **بدنه درخواست:**

    ```json
    {
      "username": "string",
      "email": "string",
      "password": "string"
    }
    ```

    - **پاسخ:** جزئیات کاربر تازه ایجاد شده را برمی‌گرداند.

- **ورود:**

    - **آدرس:** `POST /auth/login` یا `POST /auth/token`
    - **فرم داده‌های درخواست:**
        - `username`: ایمیل کاربر.
        - `password`: رمز عبور کاربر.
    - **پاسخ:**

    ```json
    {
      "access_token": "string",
      "token_type": "bearer"
    }
    ```

- **دریافت اطلاعات کاربر جاری:**

    - **آدرس:** `GET /auth/users/me`
    - **پاسخ:** اطلاعات کاربر احراز هویت شده را برمی‌گرداند.

### چت‌های خصوصی

- **دریافت چت‌های خصوصی:**
    - **آدرس:** `GET /chat/private_chats/`
    - **پاسخ:** لیستی از چت‌های خصوصی با وضعیت آنلاین شرکت‌کنندگان را برمی‌گرداند.

### اتاق‌های چت

- **ایجاد اتاق چت جدید:**

    - **آدرس:** `POST /chat/chat_rooms/`
    - **بدنه درخواست:**

    ```json
    {
      "name": "string",
      "description": "string",
      "members": ["string"]
    }
    ```

    - **پاسخ:** جزئیات اتاق چت تازه ایجاد شده را برمی‌گرداند.

- **دریافت جزئیات اتاق چت:**

    - **آدرس:** `GET /chat/chat_rooms/{room_id}`
    - **پاسخ:** جزئیات اتاق چت را برمی‌گرداند.

- **ارسال پیام:**

    - **آدرس:** `POST /chat/chat_rooms/{room_id}/messages`
    - **بدنه درخواست:**

    ```json
    {
      "content": "string"
    }
    ```

    - **پاسخ:** جزئیات پیام ارسال شده را برمی‌گرداند.

- **دریافت تمامی پیام‌ها:**

    - **آدرس:** `GET /chat/chat_rooms/{room_id}/messages`
    - **پاسخ:** لیستی از پیام‌های اتاق چت را برمی‌گرداند.

### آپلود رسانه

- **آپلود رسانه:**
    - **آدرس:** `POST /chat/upload_media/`
    - **درخواست:** فرم داده‌ها به همراه فایلی که باید آپلود شود.
    - **پاسخ:** آدرس URL فایل آپلود شده را برمی‌گرداند.

### رویدادهای WebSocket (Socket.IO)

- **اتصال:** اتصال WebSocket با سرور برقرار می‌کند. نیاز به یک توکن JWT معتبر دارد.
- **قطع اتصال:** کاربر را از سیستم خارج کرده و وضعیت آنلاین او را علامت‌گذاری می‌کند.
- **ارسال پیام:** پیام چت را به یک اتاق ارسال می‌کند.
- **دریافت کاربران آنلاین:** لیست کاربران آنلاین را بازیابی می‌کند.

## جزئیات فنی

- **بک‌اند:** FastAPI
- **دیتابیس:** MongoDB
- **WebSocket:** Socket.IO
- **احراز هویت:** JWT (توکن‌های وب JSON)
- **ذخیره‌سازی رسانه:** ذخیره‌سازی محلی (قابل تنظیم برای ذخیره‌سازی ابری)
- **محیط:** قابل تنظیم از طریق فایل `.env`

## لایسنس

این پروژه تحت مجوز MIT منتشر شده است.